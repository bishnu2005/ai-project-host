[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0

; ---------- INTERNAL SERVICES (loopback only) ----------
[program:vad]
directory=/app/services/vad
command=uvicorn app:app --host 127.0.0.1 --port 8001
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:diarization]
directory=/app/services/diarization
command=uvicorn app:app --host 127.0.0.1 --port 8002
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:stt]
directory=/app/services/stt
command=uvicorn app:app --host 127.0.0.1 --port 8003
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
environment=STT_MODEL_SIZE="small"

[program:emotion]
directory=/app/services/emotion
command=uvicorn app:app --host 127.0.0.1 --port 8004
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:text_sentiment]
directory=/app/services/text_sentiment
command=uvicorn app:app --host 127.0.0.1 --port 8005
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:fusion]
directory=/app/services/fusion
command=uvicorn app:app --host 127.0.0.1 --port 8006
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

[program:llm]
directory=/app/services/llm
command=uvicorn app:app --host 127.0.0.1 --port 8007
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr

; ---------- PUBLIC ENTRY (must listen on $PORT) ----------
[program:orchestrator]
directory=/app/services/orchestrator
; IMPORTANT: if your file is NOT app.py, change "app:app" accordingly (e.g., run_e2e:app)
command=/bin/sh -c 'uvicorn app:app --host 0.0.0.0 --port ${PORT:-8000}'
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
